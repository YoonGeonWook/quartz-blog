data
# sample size
sample_size = data %>% group_by(name) %>% summarize(num=n())
sample_size
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num))
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4)
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width=0.1, color="grey", alpha=0.2)
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width=0.1, color="grey", alpha=0.2) +
scale_fill_viridis(discrete = TRUE)
# Plot
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width=1, color="grey", alpha=0.2) +
scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("A Violin wrapping a boxplot") +
xlab("")
# Plot
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width0.5, color="grey", alpha=0.2) +
scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("A Violin wrapping a boxplot") +
xlab("")
# Plot
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.5, color="grey", alpha=0.2) +
scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("A Violin wrapping a boxplot") +
xlab("")
# Plot
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.5, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("A Violin wrapping a boxplot") +
xlab("")
# Plot
data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
ggplot( aes(x=myaxis, y=value, fill=name)) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("A Violin wrapping a boxplot") +
xlab("")
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, color = factor(target), fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
geom_boxplot() +
scale_fill_viridis(discrete = TRUE) +
ggtitle(paste0("Box plots of ", as.character(num), " by target")) +
theme_light() +
guides(color = 'none')
}
num_p <- map(numeric_vars, plot_numerical)
num_p
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
geom_boxplot() +
scale_fill_viridis(discrete = TRUE) +
ggtitle(paste0("Box plots of ", as.character(num), " by target")) +
theme_light() +
guides(color = 'none')
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
ggtitle(paste0("Box plots of ", as.character(num), " by target")) +
theme_light() +
guides(color = 'none')
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
ggtitle(paste0("Box plots of ", as.character(num), " by target")) +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, color="grey", alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1.4) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
ggplot(aes(x = factor(target), y = !!num, fill = factor(target))) +
geom_violin(width=1) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) +
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) +
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) +
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) %>%
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.1, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]]
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]] +
plot_layout(ncol = 3)
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) %>%
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.3, alpha=0.7) +
# scale_fill_viridis(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]] +
plot_layout(ncol = 3)
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) %>%
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.3, alpha=0.7) +
scale_fill_nejm(discrete = TRUE) +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
#### Yeo-Johnson 변환 후 target 변수와의 관계 확인 - boxplot with violin plot
plot_numerical <- function(num){
num <- ensym(num)
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) %>%
ggplot(aes(x = target, y = !!num, fill = target)) +
geom_violin(width=1) +
geom_boxplot(width = 0.3, alpha=0.7) +
scale_fill_nejm() +
coord_flip() +
theme_light() +
guides(color = 'none') +
theme(legend.position = "none")
}
num_p <- map(numeric_vars, plot_numerical)
num_p[[1]]+num_p[[2]]+num_p[[3]]+
num_p[[4]]+num_p[[5]]+num_p[[6]]+
num_p[[7]]+num_p[[8]]+num_p[[9]]+
num_p[[10]]+num_p[[11]] +
plot_layout(ncol = 3)
#### 변수별 상관관계 - ANOVA 설명 분산량
mycor <- function(cnames, dat){
x.num <- dat %>% pull(cnames[1])
x.cat <- dat %>% pull(cnames[2])
suppressWarnings({
av <- anova(lm(x.num ~ x.cat))
})
sqrt(av$`Sum Sq`[1] / sum(av$`Sum Sq`))
}
basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>% names()
cnames <- basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
select_if(is.numeric) %>% names()
cnames
cnames <- basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) %>%
mutate(target = factor(target)) %>%
select_if(is.numeric) %>% names()
cnames
#### 변수별 상관관계 - ANOVA 설명 분산량
mycor <- function(cnames, dat){
x.num <- dat %>% pull(cnames[1])
x.cat <- dat %>% pull(cnames[2])
suppressWarnings({
av <- anova(lm(x.num ~ x.cat))
})
sqrt(av$`Sum Sq`[1] / sum(av$`Sum Sq`))
}
set.diff(names(train %>% select(-c(bsym, CustomerID))), "target")
setdiff(names(train %>% select(-c(bsym, CustomerID))), "target")
combs <- expand.grid(y = cnames,
x = setdiff(names(train %>% select(-c(bsym, CustomerID))), "target"))
combs
cobs$cor <- apply(combs, 1, mycor,
dat = basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) )
combs$cor <- apply(combs, 1, mycor,
dat = basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) )
combs$cor <- apply(combs, 1, mycor,
dat = basic_rec %>%
step_YeoJohnson(all_numeric_predictors()) %>%
prep(train) %>%
bake(train) )
combs
combs$lab <- sprintf("%.2f", combs$cor)
unique(combs$x)
forder <- c(cnames, setdiff(unique(combs$x), cnames))
forder
combs <- combs %>%
mutate(x = factor(x, levels = forder),
y = factor(y, levels = rev(cnames)))
combs %>%
ggplot(aes(x = x, y = y, fill = cor, label = lab)) +
geom_tile() +
geom_label(fill = "white", size = 3) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
scale_x_discrete("") +
scale_y_discrete("") +
scale_fill_viridis("Variance\nexplained", begin = 0.2)
combs %>%
ggplot(aes(x = x, y = y, fill = cor, label = lab)) +
geom_tile() +
geom_label(fill = "white", size = 3) +
theme_light() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
scale_x_discrete("") +
scale_y_discrete("") +
scale_fill_viridis("Variance\nexplained", begin = 0.2)
combs
#### total_cnt 제거
basic_rec <- basic_rec %>%
step_rm(total_cnt)
