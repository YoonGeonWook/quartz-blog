332020L,
227978L,
56691L,
41605L,
53765L,
40048L,
73985L,
55589L,
68163L,
57001L,
70177L,
60962L,
96581L,
76360L,
104893L,
76792L,
19608L,
15915L
) %>%
as.data.frame() %>%
mutate(시도 = rep(c("서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주"), each = 2),
성별 = rep(c("남", "여"), times = 17)) %>%
pivot_wider(names_from = 성별, values_from = V1) %>%
group_by(시도) %>%
mutate(성비차이 = abs(남-여)/sum(남, 여)) %>%
arrange(-성비차이) %>%
as.data.frame()
tibble::tribble(
~`15~19`,    ~`20~29`,    ~`30~39`,    ~`40~49`,    ~`50~59`,    ~`60~69`,     ~`70~`,
2882,   9568,  11621,  20169,  36790,  56891,   78835,
1586,   5459,   6253,   9616,  17794,  33128,   85169,
1153,   3535,   4459,   8906,  16708,  28331,   36560,
649,   1969,   2259,   4177,   7870,  15774,   37672,
926,   3126,   3610,   6878,  13440,  19622,   25168,
523,   1645,   1686,   3274,   6270,  10841,   29176,
1124,   3297,   4064,   8384,  16172,  25176,   28000,
625,   1976,   2198,   3694,   7296,  13228,   30579,
720,   2017,   2252,   4479,   7694,   9238,   11406,
382,   1230,   1360,   2177,   3763,   5808,   14413,
666,   2128,   2191,   4215,   7890,  10771,   12511,
424,   1173,   1186,   2062,   3606,   6134,   14333,
405,   1372,   1546,   3001,   5828,   8537,    9150,
278,    679,    757,   1342,   2611,   4647,    9200,
121,    336,    525,   1153,   1339,   1700,    2115,
74,    192,    223,    393,    566,    966,    2490,
5065,  15194,  17622,  35483,  64699,  90504,  103453,
2856,   8349,   8817,  15061,  28239,  48651,  116005,
576,   1828,   2195,   4977,   9973,  15970,   21172,
326,   1080,   1161,   2325,   4501,   9080,   23132,
747,   2283,   2726,   5364,   9974,  15001,   17670,
450,   1315,   1481,   2383,   4558,   8342,   21519,
924,   2727,   3364,   7686,  13181,  18966,   27137,
491,   1503,   1830,   3276,   5697,  10912,   31880,
814,   2416,   2800,   6369,  12348,  17734,   25682,
448,   1378,   1589,   3025,   5774,  10713,   34074,
737,   2346,   2760,   6203,  13018,  18490,   26623,
395,   1294,   1457,   2796,   5813,  11167,   38040,
1084,   3287,   4242,   8967,  16624,  25377,   37000,
583,   1691,   2028,   3944,   7407,  14786,   45921,
1344,   3847,   4646,  10371,  20655,  29815,   34215,
680,   2014,   2381,   4558,   8714,  16363,   42082,
386,    946,    985,   2113,   4060,   4635,    6483,
188,    523,    578,   1015,   2072,   2806,    8733
)
tibble::tribble(
~`15~19`,    ~`20~29`,    ~`30~39`,    ~`40~49`,    ~`50~59`,    ~`60~69`,     ~`70~`,
2882,   9568,  11621,  20169,  36790,  56891,   78835,
1586,   5459,   6253,   9616,  17794,  33128,   85169,
1153,   3535,   4459,   8906,  16708,  28331,   36560,
649,   1969,   2259,   4177,   7870,  15774,   37672,
926,   3126,   3610,   6878,  13440,  19622,   25168,
523,   1645,   1686,   3274,   6270,  10841,   29176,
1124,   3297,   4064,   8384,  16172,  25176,   28000,
625,   1976,   2198,   3694,   7296,  13228,   30579,
720,   2017,   2252,   4479,   7694,   9238,   11406,
382,   1230,   1360,   2177,   3763,   5808,   14413,
666,   2128,   2191,   4215,   7890,  10771,   12511,
424,   1173,   1186,   2062,   3606,   6134,   14333,
405,   1372,   1546,   3001,   5828,   8537,    9150,
278,    679,    757,   1342,   2611,   4647,    9200,
121,    336,    525,   1153,   1339,   1700,    2115,
74,    192,    223,    393,    566,    966,    2490,
5065,  15194,  17622,  35483,  64699,  90504,  103453,
2856,   8349,   8817,  15061,  28239,  48651,  116005,
576,   1828,   2195,   4977,   9973,  15970,   21172,
326,   1080,   1161,   2325,   4501,   9080,   23132,
747,   2283,   2726,   5364,   9974,  15001,   17670,
450,   1315,   1481,   2383,   4558,   8342,   21519,
924,   2727,   3364,   7686,  13181,  18966,   27137,
491,   1503,   1830,   3276,   5697,  10912,   31880,
814,   2416,   2800,   6369,  12348,  17734,   25682,
448,   1378,   1589,   3025,   5774,  10713,   34074,
737,   2346,   2760,   6203,  13018,  18490,   26623,
395,   1294,   1457,   2796,   5813,  11167,   38040,
1084,   3287,   4242,   8967,  16624,  25377,   37000,
583,   1691,   2028,   3944,   7407,  14786,   45921,
1344,   3847,   4646,  10371,  20655,  29815,   34215,
680,   2014,   2381,   4558,   8714,  16363,   42082,
386,    946,    985,   2113,   4060,   4635,    6483,
188,    523,    578,   1015,   2072,   2806,    8733
) %>%
mutate(시도 = rep(c("서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주"), each = 2),
성별 = rep(c("남", "여"), times = 17))
tibble::tribble(
~`15~19`,    ~`20~29`,    ~`30~39`,    ~`40~49`,    ~`50~59`,    ~`60~69`,     ~`70~`,
2882,   9568,  11621,  20169,  36790,  56891,   78835,
1586,   5459,   6253,   9616,  17794,  33128,   85169,
1153,   3535,   4459,   8906,  16708,  28331,   36560,
649,   1969,   2259,   4177,   7870,  15774,   37672,
926,   3126,   3610,   6878,  13440,  19622,   25168,
523,   1645,   1686,   3274,   6270,  10841,   29176,
1124,   3297,   4064,   8384,  16172,  25176,   28000,
625,   1976,   2198,   3694,   7296,  13228,   30579,
720,   2017,   2252,   4479,   7694,   9238,   11406,
382,   1230,   1360,   2177,   3763,   5808,   14413,
666,   2128,   2191,   4215,   7890,  10771,   12511,
424,   1173,   1186,   2062,   3606,   6134,   14333,
405,   1372,   1546,   3001,   5828,   8537,    9150,
278,    679,    757,   1342,   2611,   4647,    9200,
121,    336,    525,   1153,   1339,   1700,    2115,
74,    192,    223,    393,    566,    966,    2490,
5065,  15194,  17622,  35483,  64699,  90504,  103453,
2856,   8349,   8817,  15061,  28239,  48651,  116005,
576,   1828,   2195,   4977,   9973,  15970,   21172,
326,   1080,   1161,   2325,   4501,   9080,   23132,
747,   2283,   2726,   5364,   9974,  15001,   17670,
450,   1315,   1481,   2383,   4558,   8342,   21519,
924,   2727,   3364,   7686,  13181,  18966,   27137,
491,   1503,   1830,   3276,   5697,  10912,   31880,
814,   2416,   2800,   6369,  12348,  17734,   25682,
448,   1378,   1589,   3025,   5774,  10713,   34074,
737,   2346,   2760,   6203,  13018,  18490,   26623,
395,   1294,   1457,   2796,   5813,  11167,   38040,
1084,   3287,   4242,   8967,  16624,  25377,   37000,
583,   1691,   2028,   3944,   7407,  14786,   45921,
1344,   3847,   4646,  10371,  20655,  29815,   34215,
680,   2014,   2381,   4558,   8714,  16363,   42082,
386,    946,    985,   2113,   4060,   4635,    6483,
188,    523,    578,   1015,   2072,   2806,    8733
) %>%
mutate(시도 = rep(c("서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주"), each = 2),
성별 = rep(c("남", "여"), times = 17)) %>%
pivot_longer(cols = 1:7, names_to = "연령")
tibble::tribble(
~`15~19`,    ~`20~29`,    ~`30~39`,    ~`40~49`,    ~`50~59`,    ~`60~69`,     ~`70~`,
2882,   9568,  11621,  20169,  36790,  56891,   78835,
1586,   5459,   6253,   9616,  17794,  33128,   85169,
1153,   3535,   4459,   8906,  16708,  28331,   36560,
649,   1969,   2259,   4177,   7870,  15774,   37672,
926,   3126,   3610,   6878,  13440,  19622,   25168,
523,   1645,   1686,   3274,   6270,  10841,   29176,
1124,   3297,   4064,   8384,  16172,  25176,   28000,
625,   1976,   2198,   3694,   7296,  13228,   30579,
720,   2017,   2252,   4479,   7694,   9238,   11406,
382,   1230,   1360,   2177,   3763,   5808,   14413,
666,   2128,   2191,   4215,   7890,  10771,   12511,
424,   1173,   1186,   2062,   3606,   6134,   14333,
405,   1372,   1546,   3001,   5828,   8537,    9150,
278,    679,    757,   1342,   2611,   4647,    9200,
121,    336,    525,   1153,   1339,   1700,    2115,
74,    192,    223,    393,    566,    966,    2490,
5065,  15194,  17622,  35483,  64699,  90504,  103453,
2856,   8349,   8817,  15061,  28239,  48651,  116005,
576,   1828,   2195,   4977,   9973,  15970,   21172,
326,   1080,   1161,   2325,   4501,   9080,   23132,
747,   2283,   2726,   5364,   9974,  15001,   17670,
450,   1315,   1481,   2383,   4558,   8342,   21519,
924,   2727,   3364,   7686,  13181,  18966,   27137,
491,   1503,   1830,   3276,   5697,  10912,   31880,
814,   2416,   2800,   6369,  12348,  17734,   25682,
448,   1378,   1589,   3025,   5774,  10713,   34074,
737,   2346,   2760,   6203,  13018,  18490,   26623,
395,   1294,   1457,   2796,   5813,  11167,   38040,
1084,   3287,   4242,   8967,  16624,  25377,   37000,
583,   1691,   2028,   3944,   7407,  14786,   45921,
1344,   3847,   4646,  10371,  20655,  29815,   34215,
680,   2014,   2381,   4558,   8714,  16363,   42082,
386,    946,    985,   2113,   4060,   4635,    6483,
188,    523,    578,   1015,   2072,   2806,    8733
) %>%
mutate(시도 = rep(c("서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주"), each = 2),
성별 = rep(c("남", "여"), times = 17)) %>%
pivot_longer(cols = 1:7, names_to = "연령", values_to = "count")
tibble::tribble(
~`15~19`,    ~`20~29`,    ~`30~39`,    ~`40~49`,    ~`50~59`,    ~`60~69`,     ~`70~`,
2882,   9568,  11621,  20169,  36790,  56891,   78835,
1586,   5459,   6253,   9616,  17794,  33128,   85169,
1153,   3535,   4459,   8906,  16708,  28331,   36560,
649,   1969,   2259,   4177,   7870,  15774,   37672,
926,   3126,   3610,   6878,  13440,  19622,   25168,
523,   1645,   1686,   3274,   6270,  10841,   29176,
1124,   3297,   4064,   8384,  16172,  25176,   28000,
625,   1976,   2198,   3694,   7296,  13228,   30579,
720,   2017,   2252,   4479,   7694,   9238,   11406,
382,   1230,   1360,   2177,   3763,   5808,   14413,
666,   2128,   2191,   4215,   7890,  10771,   12511,
424,   1173,   1186,   2062,   3606,   6134,   14333,
405,   1372,   1546,   3001,   5828,   8537,    9150,
278,    679,    757,   1342,   2611,   4647,    9200,
121,    336,    525,   1153,   1339,   1700,    2115,
74,    192,    223,    393,    566,    966,    2490,
5065,  15194,  17622,  35483,  64699,  90504,  103453,
2856,   8349,   8817,  15061,  28239,  48651,  116005,
576,   1828,   2195,   4977,   9973,  15970,   21172,
326,   1080,   1161,   2325,   4501,   9080,   23132,
747,   2283,   2726,   5364,   9974,  15001,   17670,
450,   1315,   1481,   2383,   4558,   8342,   21519,
924,   2727,   3364,   7686,  13181,  18966,   27137,
491,   1503,   1830,   3276,   5697,  10912,   31880,
814,   2416,   2800,   6369,  12348,  17734,   25682,
448,   1378,   1589,   3025,   5774,  10713,   34074,
737,   2346,   2760,   6203,  13018,  18490,   26623,
395,   1294,   1457,   2796,   5813,  11167,   38040,
1084,   3287,   4242,   8967,  16624,  25377,   37000,
583,   1691,   2028,   3944,   7407,  14786,   45921,
1344,   3847,   4646,  10371,  20655,  29815,   34215,
680,   2014,   2381,   4558,   8714,  16363,   42082,
386,    946,    985,   2113,   4060,   4635,    6483,
188,    523,    578,   1015,   2072,   2806,    8733
) %>%
mutate(시도 = rep(c("서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주"), each = 2),
성별 = rep(c("남", "여"), times = 17)) %>%
pivot_longer(cols = 1:7, names_to = "연령", values_to = "count") -> df
df %>%
group_by(연령) %>%
reframe(count = sum(count))
df %>%
group_by(연령) %>%
reframe(count = sum(count)) %>%
mutate(prop = count/sum(count))
df_1 <- df %>%
group_by(연령) %>%
reframe(count = sum(count)) %>%
mutate(prop = count/sum(count))
df_1$prop[4:7] %>% sum()
df_1$prop[7]
df_1 %>% as.data.frame()
0.08249279-0.04279297
0.15447800-0.08249279
0.42756721-0.24378137
df %>%
group_by(성별, 연령) %>%
reframe(count = sum(count)) %>%
mutate(prop = count/sum(count))
df %>%
group_by(성별, 연령) %>%
reframe(count = sum(count)) %>%
mutate(prop = count/sum(count)) %>%
as.data.frame()
df %>%
group_by(성별, 연령) %>%
reframe(count = sum(count)) %>%
group_by(성별) %>%
mutate(prop = count/sum(count)) %>%
as.data.frame()
0.09867693 - 0.04882639
0.18436926-0.09867693
0.34309661-0.27053207
0.54258220-0.20735769
tibble::tribble(
~"중증",      ~"경증",     ~"장애유형형",
277L,   14632L,     "간",
128405L,   99345L,   "뇌병변",
1728L,    5078L,   "뇌전증",
44740L,  200486L,    "시각",
77042L,   27028L,    "신장",
3486L,    1194L,    "심장",
502L,    2205L,    "안면",
2949L,   15032L,    "언어",
21056L,       NA, "자폐성장애",
161L,   16386L, "장루.요루",
102162L,    1070L,    "정신",
200029L,       NA,  "지적장애",
133951L, 1015378L,    "지체",
45263L,  373387L,    "청각",
10221L,     496L,   "호흡기"
) %>%
pivot_longer(cols = 1:2, names_to = "중증여부", values_to = "count")
dft <- tibble::tribble(
~"중증",      ~"경증",     ~"장애유형형",
277L,   14632L,     "간",
128405L,   99345L,   "뇌병변",
1728L,    5078L,   "뇌전증",
44740L,  200486L,    "시각",
77042L,   27028L,    "신장",
3486L,    1194L,    "심장",
502L,    2205L,    "안면",
2949L,   15032L,    "언어",
21056L,       NA, "자폐성장애",
161L,   16386L, "장루.요루",
102162L,    1070L,    "정신",
200029L,       NA,  "지적장애",
133951L, 1015378L,    "지체",
45263L,  373387L,    "청각",
10221L,     496L,   "호흡기"
) %>%
pivot_longer(cols = 1:2, names_to = "중증여부", values_to = "count")
dft <- tibble::tribble(
~"중증",      ~"경증",     ~"장애유형",
277L,   14632L,     "간",
128405L,   99345L,   "뇌병변",
1728L,    5078L,   "뇌전증",
44740L,  200486L,    "시각",
77042L,   27028L,    "신장",
3486L,    1194L,    "심장",
502L,    2205L,    "안면",
2949L,   15032L,    "언어",
21056L,       NA, "자폐성장애",
161L,   16386L, "장루.요루",
102162L,    1070L,    "정신",
200029L,       NA,  "지적장애",
133951L, 1015378L,    "지체",
45263L,  373387L,    "청각",
10221L,     496L,   "호흡기"
) %>%
pivot_longer(cols = 1:2, names_to = "중증여부", values_to = "count")
dft %>%
group_by(장애유형) %>%
reframe(count = sum(count)) %>%
mutate(prop = count/sum(count))
dft %>%
group_by(장애유형) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count))
dft %>%
group_by(장애유형) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>%
arrange(prop)
dft %>%
group_by(장애유형) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>%
arrange(prop) %>% as.data.frame()
dft %>%
group_by(중증여부) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>%
arrange(prop)
dft %>%
group_by(중증여부) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>%
arrange(prop) %>% as.data.frame()
dft %>%
group_by(장애유형, 중증여부) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>%
arrange(prop) %>% as.data.frame()
dft %>%
group_by(장애유형, 중증여부) %>%
reframe(count = sum(count, na.rm = T)) %>%
mutate(prop = count/sum(count)) %>% as.data.frame()
dft %>%
group_by(장애유형, 중증여부) %>%
reframe(count = sum(count, na.rm = T)) %>%
group_by(장애유형) %>%
mutate(prop = count/sum(count)) %>% as.data.frame()
df <- tibble::tribble(
~연령,     ~중증,     ~경증,
"15~19",  26260L,    4372,
"20~29",  75714L,   18009,
"30~39",  70834L,   38018,
"40~49",  93235L,  116601,
"50~59", 142156L,  250788,
"60~69", 168986L,  451118,
"70~", 194787L,  892811
)
df %>% pivot_longer(cols = 2:3, names_to = "중증여부", values_to = count)
df %>% pivot_longer(cols = 2:3, names_to = "중증여부", values_to = "count")
df %>% pivot_longer(cols = 2:3, names_to = "중증여부", values_to = "count") %>%
group_by(연령, 중증여부) %>%
reframe(count = sum(count))
df %>% pivot_longer(cols = 2:3, names_to = "중증여부", values_to = "count") %>%
group_by(연령, 중증여부) %>%
reframe(count = sum(count)) %>%
group_by(연령) %>%
mutate(prop = count/sum(count))
df %>% pivot_longer(cols = 2:3, names_to = "중증여부", values_to = "count") %>%
group_by(연령, 중증여부) %>%
reframe(count = sum(count)) %>%
group_by(연령) %>%
mutate(prop = count/sum(count)) %>%
as.data.frame()
install.packages("gptstudio")
gptstudio:::addin_chatgpt()
setwd("C:/Users/USER/Desktop/quartz/content/R/e-commerce")
library(tidyverse)
# 02. Data Readiness Check & Sampling
## 02-01. Data info Check
df <- read_csv("../../data/e-commerce/Online Retail.csv", col_type = "ccciTdcc")
df %>% head()
df %>% glimpse()
### 결측치 확인
df %>% is.na() %>% colSums()
df <- df %>% drop_na("CustomerID")
df %>% is.na() %>% colSums()
### Outlier 확인
df %>%
select_if(is.numeric) %>%
summary()
### Quantity가 음수인 데이터 확인: 반품/회수 물량일 수 있음
df %>% filter(Quantity < 0)
### Quantity 음수값 제거
df <- df %>%
filter(Quantity > 0)
### 중복 데이터 확인
df %>%
mutate(duplicated = duplicated(.)) %>%
count(duplicated)
df %>%
filter(duplicated(df) | duplicated(df, fromLast = T))
### 중복 삭제 후 재확인
df <- df %>% distinct()
df %>%
mutate(duplicated = duplicated(.)) %>%
count(duplicated)
### 1,067,370 → 779,494
df %>% dim()
## 02-02. Data Readiness Check
library(lubridate)
### 기준년월 변수 생성: bsym - %Y-%m 형식
df <- df %>%
mutate(bsym = format(InvoiceDate, "%Y-%m"))
### 원본 데이터 저장: df_origin
df_origin <- df
# 데이터 적재 기간 확인: 2009-12-01 ~ 2011-12-09 (약 2년)
min(df$InvoiceDate); max(df$InvoiceDate)
df <- df %>%
distinct(bsym, CustomerID)
df %>% dim()
df %>% head()
# 주어진 bsym에 구매 고객이 내월 구매 고객일 경우 1, 그렇지 않으면 0 값을 갖는 target 변수 생성: process_bsym()
process_bsym <- function(bsym_value, df) {
df_left <- filter(df, bsym == bsym_value)
bsym_1m <- ymd(paste0(bsym_value, "-01")) %m+% months(1) %>% format("%Y-%m")
df_right <- df %>%
filter(bsym == bsym_1m) %>%
distinct(CustomerID) %>%
mutate(target = 1)
df_merge <- left_join(df_left, df_right, by = "CustomerID") %>%
mutate(target = ifelse(is.na(target), 0, target))
return(df_merge)
}
# 모든 bsym 값에 대해 process_bsym 함수 적용
df_all <- map_df(unique(df$bsym), ~process_bsym(.x, df))
df_all %>% head()
### (2) Target Ratio 확인
#### bsym 기준 target ratio:
options(pillar.sigfig = 6)
df_target <- df_all %>%
group_by(bsym) %>%
reframe(total_y = sum(target),
count_y = n(),
ratio = total_y/count_y)
df_target %>%
print(n = nrow(.))
#### 2011-12에 해당하는 데이터 제외
df_target <- df_target %>% filter(bsym != '2011-12')
df_all <- df_all %>% filter(bsym != '2011-12')
df_target$ratio %>% summary()
df_all$target %>% mean()
#### 마지막 행에 합계 추가
df_target <- df_target %>%
bind_rows(
tibble(bsym = "total",
total_y = sum(.$total_y),
count_y = sum(.$count_y),
ratio = 1)
)
## 02-03. Data Sampling
df_all %>% dim()
#### 전체 데이터의 30%: 7,495개
round(nrow(df_all) * 0.3)
#### 모집단 층 크기: Nh, 표본 층 크기: nh
df_target <- df_target %>%
mutate(N = nrow(df_all)) %>%
mutate(n = round(nrow(df_all) * 0.3)) %>%
relocate(count_y, .after = n) %>%
rename(Nh = count_y) %>%
mutate(nh = round(n*Nh/N)) %>%
group_by(bsym)
df_target %>% print(n=25)
df_target$nh[-25] %>% sum()
# 반올림 때문에 표본 층 크기가 n=7495 보다 1개 더 크므로
# 2011년 11월 표본 크기를 한 개 줄여주자
df_target$nh[df_target$bsym=='2011-11'] <- df_target$nh[df_target$bsym=='2011-11'] - 1
set.seed(123)
ord <- unique(df_target$bsym)
units <- sampling::strata(df_all, stratanames = "bsym", size = df_target$nh[1:24], method="srswor")
df_all_sample <- df_all %>%
slice(units$ID_unit)
df_all_sample %>% dim()
library(gt)
library(gtExtras)
df_tmp <- df_all_sample %>%
group_by(bsym) %>%
reframe(sum_y = sum(target),
nh = n())
df_tmp2 <- df_tmp %>%
mutate(target_ratio = sum_y/nh,
target_ratio_pop = df_target$ratio[1:24]) %>%
pivot_longer(cols=c(target_ratio, target_ratio_pop), names_to = 'name') %>%
group_by(bsym) %>%
reframe(target_ratio = list(value))
df_tmp %>% left_join(df_tmp2, by='bsym') %>%
gt() %>%
gt_theme_nytimes() %>%
tab_header(title = "bsym별 target 비율") %>%
gt_plt_bar_stack(column = target_ratio, labels = c("target_ratio", "target_ratio_pop"), palette = c("skyblue", "hotpink"))
df_all_sample$target %>% mean()
df_all$target %>% mean()
